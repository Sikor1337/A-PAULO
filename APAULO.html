<!DOCTYPE html>
<html lang="pl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A PAULO v4.5 FINAL - Wszystkie funkcje</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        :root {
            --bg-dark: #1e2330;
            --bg-card: #282d3e;
            --bg-hover: #353b4f;
            --text-primary: #ffffff;
            --text-secondary: #a8b2d1;
            --accent-blue: #5b9cff;
            --accent-green: #4ade80;
            --accent-red: #f87171;
            --accent-purple: #a78bfa;
            --accent-orange: #fb923c;
            --border-color: #3d4458;
            --sidebar-width: 280px
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6
        }

        .app-container {
            display: flex;
            min-height: 100vh
        }

        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-card);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border-color)
        }

        .sidebar-header h1 {
            font-size: 22px;
            font-weight: 700;
            color: var(--accent-blue)
        }

        .nav-section-title {
            padding: 0 20px;
            font-size: 11px;
            text-transform: uppercase;
            color: var(--text-secondary);
            font-weight: 600;
            margin: 20px 0 8px
        }

        .nav-item {
            padding: 12px 20px;
            cursor: pointer;
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px
        }

        .nav-item:hover {
            background: var(--bg-hover)
        }

        .nav-item.active {
            background: var(--bg-hover);
            border-left-color: var(--accent-blue);
            color: var(--accent-blue)
        }

        .nav-item-text {
            font-size: 14px;
            font-weight: 500
        }

        .nav-item-badge {
            margin-left: auto;
            background: var(--accent-blue);
            color: #fff;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600
        }

        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            padding: 32px
        }

        .content-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center
        }

        .content-title {
            font-size: 32px;
            font-weight: 700
        }

        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 4px
        }

        .btn-primary {
            background: var(--accent-blue);
            color: #fff
        }

        .btn-success {
            background: var(--accent-green);
            color: #fff
        }

        .btn-danger {
            background: var(--accent-red);
            color: #fff
        }

        .btn-warning {
            background: var(--accent-purple);
            color: #fff
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary)
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            margin: 2px
        }

        .badge-blue {
            background: var(--accent-blue);
            color: #fff
        }

        .badge-green {
            background: var(--accent-green);
            color: #fff
        }

        .badge-purple {
            background: var(--accent-purple);
            color: #fff
        }

        .badge-orange {
            background: var(--accent-orange);
            color: #fff
        }

        table {
            width: 100%;
            border-collapse: collapse
        }

        thead {
            background: var(--bg-hover)
        }

        th {
            padding: 12px;
            text-align: left;
            font-size: 12px;
            font-weight: 600
        }

        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-color)
        }

        tbody tr:hover {
            background: var(--bg-hover)
        }

        .section {
            display: none
        }

        .section.active {
            display: block
        }

        .search-input {
            width: 100%;
            padding: 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            margin-bottom: 20px
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center
        }

        .modal.active {
            display: flex
        }

        .modal-content {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 32px;
            max-width: 700px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 24px;
            color: var(--accent-blue)
        }

        .modal-footer {
            margin-top: 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end
        }

        .form-group {
            margin-bottom: 20px
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-hover);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary)
        }

        .form-textarea {
            min-height: 100px
        }

        .podopieczny-card,
        .event-card,
        .recruit-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 12px
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px
        }

        .tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 24px;
            border-bottom: 2px solid var(--border-color)
        }

        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px
        }

        .tab:hover {
            background: var(--bg-hover)
        }

        .tab.active {
            border-bottom-color: var(--accent-blue);
            color: var(--accent-blue)
        }

        .tab-content {
            display: none
        }

        .tab-content.active {
            display: block
        }
    </style>
    <!-- Supabase Client Library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>A PAULO</h1>
                <p style="font-size:12px;color:var(--text-secondary)">v4.5 FINAL</p>
            </div>
            <nav>
                <div class="nav-section-title">G≈Å√ìWNE</div>
                <div class="nav-item active" onclick="showSection('groups')"><span class="nav-item-text">üë• Grupy
                        Przewodnik√≥w</span><span class="nav-item-badge">5</span></div>
                <div class="nav-item" onclick="showSection('volunteers')"><span class="nav-item-text">üôã
                        Wolontariusze</span><span class="nav-item-badge">135</span></div>
                <div class="nav-item" onclick="showSection('podopieczni')"><span class="nav-item-text">üë¥
                        Podopieczni</span><span class="nav-item-badge">65</span></div>
                <div class="nav-item" onclick="showSection('wydarzenia')"><span class="nav-item-text">üéØ
                        Wydarzenia</span><span class="nav-item-badge">12</span></div>
                <div class="nav-section-title">REKRUTACJA</div>
                <div class="nav-item" onclick="showSection('rec-vol')"><span class="nav-item-text">üìù Rekrutacja
                        Wolontariuszy</span><span class="nav-item-badge">25</span></div>
                <div class="nav-item" onclick="showSection('rec-pod')"><span class="nav-item-text">üìã Rekrutacja
                        Podopiecznych</span><span class="nav-item-badge">34</span></div>
                <div class="nav-section-title">DZIA≈ÅY (12)</div>
                <div class="nav-item" onclick="showSection('dept-0')"><span class="nav-item-text">ü§ù Pomoc
                        indywidualna</span></div>
                <div class="nav-item" onclick="showSection('dept-1')"><span class="nav-item-text">üî® Remonty</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-2')"><span class="nav-item-text">üßπ Grupa
                        porzƒÖdkowa</span></div>
                <div class="nav-item" onclick="showSection('dept-3')"><span class="nav-item-text">üí™ Fizjoterapia</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-4')"><span class="nav-item-text">üí∞ Ksiƒôgowo≈õƒá</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-5')"><span class="nav-item-text">üéâ Festyn
                        Seniora</span></div>
                <div class="nav-item" onclick="showSection('dept-6')"><span class="nav-item-text">üìö Szkolenia</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-7')"><span class="nav-item-text">üì± Media</span></div>
                <div class="nav-item" onclick="showSection('dept-8')"><span class="nav-item-text">üè† Klub seniora</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-9')"><span class="nav-item-text">üéµ Muzyczni</span>
                </div>
                <div class="nav-item" onclick="showSection('dept-10')"><span class="nav-item-text">üçΩÔ∏è
                        Gastronomia</span></div>
                <div class="nav-item" onclick="showSection('dept-11')"><span class="nav-item-text">üíµ Zbieranie
                        funduszy</span></div>
            </nav>
        </aside>
        <main class="main-content">
            <section id="section-groups" class="section active">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Grupy Przewodnik√≥w</h2>
                    </div><button class="btn btn-primary" onclick="openAddGroup()">‚ûï Dodaj grupƒô</button>
                </div>
                <div id="groups-container"></div>
            </section>
            <section id="section-volunteers" class="section">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Wolontariusze</h2>
                    </div><button class="btn btn-primary" onclick="openAddVol()">‚ûï Dodaj</button>
                </div>
                <div class="card">
                    <input type="text" class="search-input" placeholder="Szukaj..."
                        onkeyup="filterTable('vol-table',this.value)">
                    <table id="vol-table">
                        <thead>
                            <tr>
                                <th>Imiƒô</th>
                                <th>Email</th>
                                <th>Telefon</th>
                                <th>Status</th>
                                <th>Dzia≈Çy</th>
                                <th>Akcje</th>
                            </tr>
                        </thead>
                        <tbody id="vol-tbody"></tbody>
                    </table>
                </div>
            </section>
            <section id="section-podopieczni" class="section">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Podopieczni</h2>
                    </div><button class="btn btn-primary" onclick="openAddPod()">‚ûï Dodaj</button>
                </div>
                <div id="pod-container"></div>
            </section>
            <section id="section-wydarzenia" class="section">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Wydarzenia</h2>
                    </div><button class="btn btn-primary" onclick="openAddEvent()">‚ûï Dodaj</button>
                </div>
                <div id="wydarzenia-container"></div>
            </section>
            <section id="section-rec-vol" class="section">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Rekrutacja Wolontariuszy</h2>
                    </div>
                </div>
                <input type="text" id="rec-search" class="search-input" placeholder="Szukaj rekruta..."
                    onkeyup="filterRec()">
                <div id="rec-vol-container"></div>
            </section>
            <section id="section-rec-pod" class="section">
                <div class="content-header">
                    <div>
                        <h2 class="content-title">Rekrutacja Podopiecznych</h2>
                    </div>
                </div>
                <div id="rec-pod-container"></div>
            </section>
            <section id="section-dept-0" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-0">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(0,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(0,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(0,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(0,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-0-tab-0"></div>
                <div class="tab-content" id="dept-0-tab-1"></div>
                <div class="tab-content" id="dept-0-tab-2"></div>
                <div class="tab-content" id="dept-0-tab-3"></div>
            </section>
            <section id="section-dept-1" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-1">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(1,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(1,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(1,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(1,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-1-tab-0"></div>
                <div class="tab-content" id="dept-1-tab-1"></div>
                <div class="tab-content" id="dept-1-tab-2"></div>
                <div class="tab-content" id="dept-1-tab-3"></div>
            </section>
            <section id="section-dept-2" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-2">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(2,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(2,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(2,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(2,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-2-tab-0"></div>
                <div class="tab-content" id="dept-2-tab-1"></div>
                <div class="tab-content" id="dept-2-tab-2"></div>
                <div class="tab-content" id="dept-2-tab-3"></div>
            </section>
            <section id="section-dept-3" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-3">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(3,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(3,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(3,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(3,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-3-tab-0"></div>
                <div class="tab-content" id="dept-3-tab-1"></div>
                <div class="tab-content" id="dept-3-tab-2"></div>
                <div class="tab-content" id="dept-3-tab-3"></div>
            </section>
            <section id="section-dept-4" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-4">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(4,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(4,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(4,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(4,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-4-tab-0"></div>
                <div class="tab-content" id="dept-4-tab-1"></div>
                <div class="tab-content" id="dept-4-tab-2"></div>
                <div class="tab-content" id="dept-4-tab-3"></div>
            </section>
            <section id="section-dept-5" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-5">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(5,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(5,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(5,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(5,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-5-tab-0"></div>
                <div class="tab-content" id="dept-5-tab-1"></div>
                <div class="tab-content" id="dept-5-tab-2"></div>
                <div class="tab-content" id="dept-5-tab-3"></div>
            </section>
            <section id="section-dept-6" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-6">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(6,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(6,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(6,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(6,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-6-tab-0"></div>
                <div class="tab-content" id="dept-6-tab-1"></div>
                <div class="tab-content" id="dept-6-tab-2"></div>
                <div class="tab-content" id="dept-6-tab-3"></div>
            </section>
            <section id="section-dept-7" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-7">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(7,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(7,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(7,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(7,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-7-tab-0"></div>
                <div class="tab-content" id="dept-7-tab-1"></div>
                <div class="tab-content" id="dept-7-tab-2"></div>
                <div class="tab-content" id="dept-7-tab-3"></div>
            </section>
            <section id="section-dept-8" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-8">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(8,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(8,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(8,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(8,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-8-tab-0"></div>
                <div class="tab-content" id="dept-8-tab-1"></div>
                <div class="tab-content" id="dept-8-tab-2"></div>
                <div class="tab-content" id="dept-8-tab-3"></div>
            </section>
            <section id="section-dept-9" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-9">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(9,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(9,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(9,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(9,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-9-tab-0"></div>
                <div class="tab-content" id="dept-9-tab-1"></div>
                <div class="tab-content" id="dept-9-tab-2"></div>
                <div class="tab-content" id="dept-9-tab-3"></div>
            </section>
            <section id="section-dept-10" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-10">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(10,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(10,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(10,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(10,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-10-tab-0"></div>
                <div class="tab-content" id="dept-10-tab-1"></div>
                <div class="tab-content" id="dept-10-tab-2"></div>
                <div class="tab-content" id="dept-10-tab-3"></div>
            </section>
            <section id="section-dept-11" class="section">
                <div class="content-header">
                    <h2 class="content-title" id="dept-title-11">Dzia≈Ç</h2>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTab(11,0)">Cz≈Çonkowie</div>
                    <div class="tab" onclick="showTab(11,1)">Wydarzenia</div>
                    <div class="tab" onclick="showTab(11,2)">Sprzƒôt</div>
                    <div class="tab" onclick="showTab(11,3)">Powiadomienia</div>
                </div>
                <div class="tab-content active" id="dept-11-tab-0"></div>
                <div class="tab-content" id="dept-11-tab-1"></div>
                <div class="tab-content" id="dept-11-tab-2"></div>
                <div class="tab-content" id="dept-11-tab-3"></div>
            </section>
        </main>
    </div>
    <!-- Modal: Rekrutacja Podopiecznych -->
    <div id="modal-edit-rec" class="modal">
        <div class="modal-content">
            <h3 class="modal-title">Edytuj Rekruta Podopiecznego</h3>
            <div class="form-group"><label class="form-label">Imiƒô</label><input type="text" class="form-input"
                    id="edit-rec-name"></div>
            <div class="form-group"><label class="form-label">Adres</label><input type="text" class="form-input"
                    id="edit-rec-address"></div>
            <div class="form-group"><label class="form-label">Telefon</label><input type="text" class="form-input"
                    id="edit-rec-phone"></div>
            <div class="form-group"><label class="form-label">Status</label><input type="text" class="form-input"
                    id="edit-rec-status"></div>
            <div class="form-group"><label class="form-label">Opis</label><textarea class="form-textarea"
                    id="edit-rec-opis"></textarea></div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Anuluj</button>
                <button class="btn btn-danger" onclick="deleteRecPod()">Usu≈Ñ</button>
                <button class="btn btn-success" onclick="promoteRecPod()">Promuj</button>
                <button class="btn btn-primary" onclick="saveRecPod()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal: Wolontariusz -->
    <div id="modal-vol" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-vol-title">Dodaj Wolontariusza</h3>
            <div class="form-group"><label class="form-label">Imiƒô i Nazwisko</label><input type="text"
                    class="form-input" id="vol-name"></div>
            <div class="form-group"><label class="form-label">Email</label><input type="email" class="form-input"
                    id="vol-email"></div>
            <div class="form-group"><label class="form-label">Telefon</label><input type="text" class="form-input"
                    id="vol-phone"></div>
            <div class="form-group"><label class="form-label">Status</label>
                <select class="form-input" id="vol-status">
                    <option value="Aktywny">Aktywny</option>
                    <option value="By≈Çy">By≈Çy</option>
                </select>
            </div>
            <div class="form-group"><label class="form-label">Grupa</label>
                <select class="form-input" id="vol-group">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                </select>
            </div>
            <div class="form-group"><label class="form-label">Dzia≈Çy</label>
                <div class="checkbox-grid" id="vol-departments"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeVolModal()">Anuluj</button>
                <button class="btn btn-primary" onclick="saveVol()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal: Podopieczny -->
    <div id="modal-pod" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-pod-title">Dodaj Podopiecznego</h3>
            <div class="form-group"><label class="form-label">Imiƒô i Nazwisko</label><input type="text"
                    class="form-input" id="pod-name"></div>
            <div class="form-group"><label class="form-label">Adres</label><input type="text" class="form-input"
                    id="pod-address"></div>
            <div class="form-group"><label class="form-label">Telefon</label><input type="text" class="form-input"
                    id="pod-phone"></div>
            <div class="form-group"><label class="form-label">Status</label>
                <select class="form-input" id="pod-status">
                    <option value="OBECNY">OBECNY</option>
                    <option value="BY≈ÅY">BY≈ÅY</option>
                    <option value="ZMAR≈ÅY">ZMAR≈ÅY</option>
                    <option value="DPS/ZOL">DPS/ZOL</option>
                </select>
            </div>
            <div class="form-group"><label class="form-label">Grupa</label>
                <select class="form-input" id="pod-group">
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                </select>
            </div>
            <div class="form-group"><label class="form-label">Opis</label><textarea class="form-textarea"
                    id="pod-opis"></textarea></div>
            <div class="form-group"><label class="form-label">BO</label>
                <select class="form-input" id="pod-bo">
                    <option value="TAK">TAK</option>
                    <option value="NIE">NIE</option>
                </select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closePodModal()">Anuluj</button>
                <button class="btn btn-primary" onclick="savePod()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal: Wydarzenie -->
    <div id="modal-event" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-event-title">Dodaj Wydarzenie</h3>
            <div class="form-group"><label class="form-label">Tytu≈Ç</label><input type="text" class="form-input"
                    id="event-title"></div>
            <div class="form-group"><label class="form-label">Opis</label><textarea class="form-textarea"
                    id="event-desc"></textarea></div>
            <div class="form-group"><label class="form-label">Data rozpoczƒôcia</label><input type="date"
                    class="form-input" id="event-start"></div>
            <div class="form-group"><label class="form-label">Data zako≈Ñczenia</label><input type="date"
                    class="form-input" id="event-end"></div>
            <div class="form-group"><label class="form-label">Status</label>
                <select class="form-input" id="event-status">
                    <option value="planned">Planowane</option>
                    <option value="inprogress">W trakcie</option>
                    <option value="completed">Zako≈Ñczone</option>
                </select>
            </div>
            <div class="form-group"><label class="form-label">Dzia≈Ç</label>
                <select class="form-input" id="event-dept"></select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEventModal()">Anuluj</button>
                <button class="btn btn-primary" onclick="saveEvent()">Zapisz</button>
            </div>
        </div>
    </div>

    <!-- Modal: Grupa -->
    <div id="modal-group" class="modal">
        <div class="modal-content">
            <h3 class="modal-title" id="modal-group-title">Edytuj Grupƒô</h3>
            <div class="form-group"><label class="form-label">Przewodnik</label>
                <select class="form-input" id="group-leader"></select>
            </div>
            <div class="form-group"><label class="form-label">Zastƒôpca</label>
                <select class="form-input" id="group-deputy"></select>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeGroupModal()">Anuluj</button>
                <button class="btn btn-primary" onclick="saveGroup()">Zapisz</button>
            </div>
        </div>
    </div>
    <script>
        // === SUPABASE CONFIGURATION ===
        const SUPABASE_URL = 'https://bskdfwgejlgnwuwohjak.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJza2Rmd2dlamxnbnd1d29oamFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM1NjExMDAsImV4cCI6MjA3OTEzNzEwMH0.V5uhnBWAeRV0oGhq76Xn7cwTWchAbUXdUCHkRt8BNwU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        console.log('‚úì Supabase client initialized:', SUPABASE_URL);

        // === GLOBAL APP_DATA - will be populated from Supabase ===
        let APP_DATA = { groups: {}, volunteers: [], podopieczni: [], rekrutacjaWolontariuszy: [], rekrutacjaPodopiecznych: [], departments: {}, wydarzenia: [], stats: {} };
        const ALL_DEPARTMENTS = ["Pomoc indywidualna", "Remonty", "Grupa porzƒÖdkowa", "Fizjoterapia", "Ksiƒôgowo≈õƒá", "Festyn Seniora", "Szkolenia", "Media", "Klub seniora", "Muzyczni", "Gastronomia", "Zbieranie funduszy"];
        let currentRecIdx = null;
        let isLoading = false;

        // === DATA LOADING FUNCTIONS ===
        async function loadVolunteers() {
            const { data, error } = await supabase.from('wolontariusze').select('*').order('id');
            if (error) { console.error('‚ùå wolontariusze:', error); return []; }
            return data.map(v => ({
                id: v.id,
                name: v.imie_i_nazwisko || '',
                email: v.adres_e_mail || '',
                phone: v.telefon || '',
                status: v.status || 'Aktywny',
                assignedPodopieczny: v.przydzielony_podopieczny || '',
                group: v.grupa_podopiecznych || '',
                departments: [
                    v.pomoc_indywidualna === 'TAK' ? 'Pomoc indywidualna' : null,
                    v.remonty === 'TAK' ? 'Remonty' : null,
                    v.grupa_porzadkowa === 'TAK' ? 'Grupa porzƒÖdkowa' : null,
                    v.fizjoterapia === 'TAK' ? 'Fizjoterapia' : null,
                    v.ksiegowosc === 'TAK' ? 'Ksiƒôgowo≈õƒá' : null,
                    v.festyn_seniora === 'TAK' ? 'Festyn Seniora' : null,
                    v.szkolenia === 'TAK' ? 'Szkolenia' : null,
                    v.media === 'TAK' ? 'Media' : null,
                    v.klub_seniora === 'TAK' ? 'Klub seniora' : null,
                    v.muzyczni === 'TAK' ? 'Muzyczni' : null,
                    v.gastronomia === 'TAK' ? 'Gastronomia' : null,
                    v.zbieranie_funduszy === 'TAK' ? 'Zbieranie funduszy' : null
                ].filter(Boolean)
            }));
        }

        async function loadPodopieczni() {
            const { data, error } = await supabase.from('podopieczni').select('*').order('id');
            if (error) { console.error('‚ùå podopieczni:', error); return []; }
            // Also load grupy_przewodnikow to get volunteer assignments
            const { data: grupy } = await supabase.from('grupy_przewodnikow').select('*');
            const volMap = {};
            if (grupy) grupy.forEach(g => { volMap[g.podopieczny] = g.wolontariusze ? g.wolontariusze.split(',').map(s => s.trim()).filter(Boolean) : []; });

            return data.map(p => ({
                id: p.id,
                name: p.imie_i_nazwisko || '',
                address: p.adres || '',
                phone: p.numer_telefonu_podopiecznego || '',
                status: p.status || 'OBECNY',
                group: p.grupa || 'E',
                opis: p.opis_podopiecznego || '',
                bo: p.bo || 'NIE',
                lastVisit: p.termin_ostatniego_spotkania_z_wolontariuszami || '',
                assignedVolunteers: volMap[p.imie_i_nazwisko] || []
            }));
        }

        async function loadGroups() {
            const { data, error } = await supabase.from('grupy_przewodnikow').select('*').order('grupa');
            if (error) { console.error('‚ùå grupy_przewodnikow:', error); return {}; }

            const groups = {};
            data.forEach(row => {
                const g = row.grupa;
                if (!groups[g]) {
                    groups[g] = { leader: '', deputy: '', podopieczni: [] };
                }
                // Set leader/deputy from first row that has them
                if (row.przewodnik_grupy && !groups[g].leader) groups[g].leader = row.przewodnik_grupy;
                if (row.zastepca_grupy && !groups[g].deputy) groups[g].deputy = row.zastepca_grupy;
                // Add podopieczny
                if (row.podopieczny) {
                    groups[g].podopieczni.push({
                        name: row.podopieczny,
                        volunteers: row.wolontariusze ? row.wolontariusze.split(',').map(s => s.trim()).filter(Boolean) : []
                    });
                }
            });
            return groups;
        }

        async function loadRecruitmentVol() {
            const { data, error } = await supabase.from('rekrutacja_wolontariuszy').select('*').order('id');
            if (error) { console.error('‚ùå rekrutacja_wolontariuszy:', error); return []; }
            return data.map(r => ({
                id: r.id,
                name: r.imie_i_nazwisko || '',
                email: r.adres_e_mail || '',
                phone: r.telefon || '',
                fb: r.link_do_fb || '',
                dateJoined: r.data_dolaczenia || '',
                info: r.opis_informacje || '',
                meetings: {
                    charyzmat: r.spotkanie_charyzmat || '',
                    wspolnota: r.spotkanie_wspolnota || '',
                    dzialanie: r.spotkanie_dzialanie || '',
                    administracja: r.spotkanie_administracja || ''
                }
            }));
        }

        async function loadRecruitmentPod() {
            const { data, error } = await supabase.from('rekrutacja_podopiecznych').select('*').order('id');
            if (error) { console.error('‚ùå rekrutacja_podopiecznych:', error); return []; }
            return data.map(r => ({
                id: r.id,
                name: r.imie_i_nazwisko || '',
                address: r.adres || '',
                phone: r.numer_telefonu_podopiecznego || '',
                osobaZglaszajaca: r.osoba_zglaszajaca || '',
                imieZglaszajacego: r.imie_i_nazwisko_zglaszajacego || '',
                telefonZglaszajacego: r.numer_telefonu_zglaszajacego || '',
                opis: r.opis || '',
                bo: r.bo || 'NIE',
                status: r.status || '',
                wymaganeAkcje: r.wymagane_akcje || '',
                potrzebneOdwiedziny: r.potrzebne_odwiedziny || '',
                dataOstatnichOdwiedzin: r.data_ostatnich_odwiedzin || '',
                wolontariusze: r.wolontariusze || '',
                stanZdrowotny: r.stan_zdrowotny || '',
                rodzajPomocy: r.rodzaj_oczekiwanej_pomocy || '',
                opisOdwiedzin: r.opis_potrzeby_przebieg_odwiedzin || '',
                rodo: r.rodo || '',
                powodNiedolaczenia: r.powod_niedolaczenia || ''
            }));
        }

        async function loadWydarzenia() {
            const { data, error } = await supabase.from('wydarzenia').select('*').order('id');
            if (error) { console.error('‚ùå wydarzenia:', error); return []; }
            return data.map(e => ({
                id: e.id,
                title: e.tytul || '',
                description: e.opis || '',
                startDate: e.data_rozpoczecia || '',
                endDate: e.data_zakonczenia || '',
                status: e.status || 'planned',
                departments: [e.dzial || 'Pomoc indywidualna'],
                todos: []
            }));
        }

        // Build departments from volunteers data
        function buildDepartments(volunteers) {
            const depts = {};
            ALL_DEPARTMENTS.forEach(d => {
                const members = volunteers.filter(v => v.departments.includes(d)).map(v => v.name);
                depts[d] = {
                    name: d,
                    members: members,
                    memberCount: members.length,
                    equipment: [{ id: 1, name: 'Przyk≈Çadowy sprzƒôt - ' + d, category: 'Sprzƒôt', purchaseDate: '2024-01-01', location: 'Magazyn g≈Ç√≥wny', currentHolder: 'Wolontariusz XYZ', notes: 'Przyk≈Çadowe notatki' }],
                    notifications: [{ id: 1, title: 'Powiadomienie - ' + d, message: 'Przyk≈Çadowa wiadomo≈õƒá', date: '2024-12-01', author: 'System', read: false }]
                };
            });
            return depts;
        }

        // === MAIN DATA LOADER ===
        async function loadAllData() {
            if (isLoading) return;
            isLoading = true;
            showLoadingIndicator('≈Åadowanie danych z Supabase...');

            try {
                const [volunteers, podopieczni, groups, rekVol, rekPod, wydarzenia] = await Promise.all([
                    loadVolunteers(),
                    loadPodopieczni(),
                    loadGroups(),
                    loadRecruitmentVol(),
                    loadRecruitmentPod(),
                    loadWydarzenia()
                ]);

                APP_DATA = {
                    volunteers,
                    podopieczni,
                    groups,
                    rekrutacjaWolontariuszy: rekVol,
                    rekrutacjaPodopiecznych: rekPod,
                    wydarzenia: wydarzenia.length > 0 ? wydarzenia : getDefaultWydarzenia(),
                    departments: buildDepartments(volunteers),
                    stats: {
                        totalVolunteers: volunteers.length,
                        totalPodopieczni: podopieczni.length,
                        totalGroups: Object.keys(groups).length,
                        totalRecruitmentVolunteers: rekVol.length,
                        totalRecruitmentPodopieczni: rekPod.length,
                        totalDepartments: ALL_DEPARTMENTS.length,
                        totalWydarzenia: wydarzenia.length
                    }
                };

                console.log('‚úÖ Loaded APP_DATA from Supabase:', APP_DATA);
                hideLoadingIndicator();
                renderAll();
            } catch (err) {
                console.error('‚ùå Error loading data:', err);
                hideLoadingIndicator();
                alert('B≈ÇƒÖd ≈Çadowania danych: ' + err.message);
            }
            isLoading = false;
        }

        function getDefaultWydarzenia() {
            return [
                { id: 1001, title: 'Odwiedziny senior√≥w - grudzie≈Ñ', description: 'Comiesiƒôczne odwiedziny', startDate: '2024-12-15', endDate: '2024-12-23', status: 'planned', departments: ['Pomoc indywidualna'], todos: [] },
                { id: 1002, title: 'Remont mieszkania', description: 'Malowanie ≈õcian', startDate: '2024-12-10', endDate: '2024-12-17', status: 'inprogress', departments: ['Remonty'], todos: [] }
            ];
        }

        function showLoadingIndicator(msg) {
            let el = document.getElementById('loading-indicator');
            if (!el) {
                el = document.createElement('div');
                el.id = 'loading-indicator';
                el.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(26,26,46,0.95);padding:32px 48px;border-radius:16px;z-index:99999;color:#fff;font-size:18px;box-shadow:0 8px 32px rgba(0,0,0,0.4);';
                document.body.appendChild(el);
            }
            el.innerHTML = '<div style="text-align:center">‚è≥ ' + msg + '</div>';
            el.style.display = 'block';
        }

        function hideLoadingIndicator() {
            const el = document.getElementById('loading-indicator');
            if (el) el.style.display = 'none';
        }

        function renderAll() {
            renderGroups();
            renderVolunteers();
            renderPodopieczni();
            renderWydarzenia();
            renderRecruitmentVol();
            renderRecruitmentPod();
            renderDepartments();
        }

        // === CONNECTION TEST ===
        async function testSupabaseConnection() {
            const statusDiv = document.createElement('div');
            statusDiv.id = 'supabase-status';
            statusDiv.style.cssText = 'position:fixed;top:20px;right:20px;padding:16px 24px;border-radius:12px;z-index:9999;font-weight:600;box-shadow:0 4px 20px rgba(0,0,0,0.3);';
            statusDiv.innerHTML = '‚è≥ Sprawdzam po≈ÇƒÖczenie z Supabase...';
            statusDiv.style.background = '#3b82f6';
            statusDiv.style.color = 'white';
            document.body.appendChild(statusDiv);

            try {
                // Test query - try to fetch from wolontariusze table
                const { data, error, count } = await supabase
                    .from('wolontariusze')
                    .select('*', { count: 'exact', head: true });

                if (error) throw error;

                statusDiv.innerHTML = `‚úÖ Supabase po≈ÇƒÖczony! Tabela wolontariusze: OK`;
                statusDiv.style.background = '#10b981';
                console.log('‚úÖ Supabase connection test PASSED');
                console.log('Tables accessible. Ready for fullstack!');

                // Also test other tables
                const tables = ['podopieczni', 'rekrutacja_wolontariuszy', 'rekrutacja_podopiecznych', 'grupy_przewodnikow'];
                let results = [];
                for (const table of tables) {
                    const { error: err } = await supabase.from(table).select('*', { count: 'exact', head: true });
                    results.push({ table, ok: !err });
                    console.log(`  - ${table}: ${err ? '‚ùå ' + err.message : '‚úÖ OK'}`);
                }

                setTimeout(() => { statusDiv.style.opacity = '0'; statusDiv.style.transition = 'opacity 0.5s'; }, 5000);
                setTimeout(() => { statusDiv.remove(); }, 5500);

            } catch (err) {
                statusDiv.innerHTML = `‚ùå B≈ÇƒÖd: ${err.message}`;
                statusDiv.style.background = '#ef4444';
                console.error('‚ùå Supabase connection FAILED:', err.message);
                console.log('Mo≈ºliwe przyczyny:');
                console.log('  1. Tabele nie zosta≈Çy utworzone - uruchom SQL migration');
                console.log('  2. RLS (Row Level Security) blokuje dostƒôp');
                console.log('  3. Nieprawid≈Çowy klucz API');
            }
        }

        // Run on page load - load all data from Supabase
        document.addEventListener('DOMContentLoaded', async () => {
            // First load data - this is critical
            await loadAllData();
            // Run connection test in background (non-blocking)
            testSupabaseConnection().catch(err => console.error('Test connection error:', err));
        });


        // === UI NAVIGATION & FILTERING ===
        function showSection(id) { document.querySelectorAll('.section').forEach(s => s.classList.remove('active')); document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); document.getElementById('section-' + id).classList.add('active'); event.target.closest('.nav-item').classList.add('active') }
        function showTab(dIdx, tIdx) { for (let i = 0; i < 4; i++) { document.getElementById(`dept-${dIdx}-tab-${i}`).classList.remove('active'); document.querySelectorAll(`#section-dept-${dIdx} .tab`)[i].classList.remove('active') } document.getElementById(`dept-${dIdx}-tab-${tIdx}`).classList.add('active'); document.querySelectorAll(`#section-dept-${dIdx} .tab`)[tIdx].classList.add('active') }
        function filterTable(tId, v) { document.querySelectorAll('#' + tId + ' tbody tr').forEach(r => r.style.display = r.textContent.toLowerCase().includes(v.toLowerCase()) ? '' : 'none') }
        function filterRec() { const v = document.getElementById('rec-search').value.toLowerCase(); document.querySelectorAll('#rec-vol-container .recruit-card').forEach(c => c.style.display = c.textContent.toLowerCase().includes(v) ? '' : 'none') }
        function openModal() { document.getElementById('modal-edit-rec').classList.add('active') }
        function closeModal() { document.getElementById('modal-edit-rec').classList.remove('active') }
        function renderGroups() { let h = ''; Object.keys(APP_DATA.groups).forEach(g => { const gr = APP_DATA.groups[g]; h += `<div class="card"><h3 style="font-size:24px;color:var(--accent-blue)">GRUPA ${g} (${gr.podopieczni.length})</h3><p>Przewodnik: <strong>${gr.leader || 'Brak'}</strong></p><p>Zastƒôpca: <strong>${gr.deputy || 'Brak'}</strong></p>${gr.podopieczni.map(p => `<div style="background:var(--bg-hover);padding:12px;border-radius:8px;margin:8px 0"><strong>${p.name}</strong><div>${p.volunteers.map(v => `<span class="badge badge-blue">${v}</span>`).join('') || 'Brak'}</div></div>`).join('')}<button class="btn btn-warning" onclick="openEditGroup('${g}')">Edytuj grupƒô</button></div>` }); document.getElementById('groups-container').innerHTML = h }
        function renderVolunteers() { let h = ''; APP_DATA.volunteers.forEach((v, i) => { h += `<tr><td>${v.name}</td><td>${v.email}</td><td>${v.phone}</td><td>${v.status}</td><td>${v.departments.map(d => `<span class="badge badge-purple">${d}</span>`).join('') || '-'}</td><td><button class="btn btn-sm btn-warning" onclick="openEditVol(${i})">Edytuj</button> <button class="btn btn-sm btn-danger" onclick="deleteVol(${i})">Usu≈Ñ</button></td></tr>` }); document.getElementById('vol-tbody').innerHTML = h }
        function deleteVol(i) { if (!confirm('UsunƒÖƒá?')) return; APP_DATA.volunteers.splice(i, 1); renderVolunteers(); alert('‚úì') }
        function renderPodopieczni() { let h = ''; APP_DATA.podopieczni.forEach((p, i) => { h += `<div class="podopieczny-card"><div style="display:flex;justify-content:space-between;align-items:start"><div><h3>${p.name} ${p.bo === 'TAK' ? '<span class="badge badge-green">BO</span>' : ''}</h3><p style="color:var(--text-secondary);margin-top:8px">üìç ${p.address}<br>üìû ${p.phone}<br>üë• Grupa ${p.group}${p.lastVisit ? ' ‚Ä¢ üìÖ ' + p.lastVisit : ''}${p.opis ? ' ‚Ä¢ ' + p.opis.substring(0, 80) + '...' : ''}</p><div style="margin-top:12px">${p.assignedVolunteers.map(v => `<span class="badge badge-blue">${v}</span>`).join('') || 'Brak'}</div></div><div><button class="btn btn-sm btn-warning" onclick="openEditPod(${i})">Edytuj</button> <button class="btn btn-sm btn-danger" onclick="deletePod(${i})">Usu≈Ñ</button></div></div></div>` }); document.getElementById('pod-container').innerHTML = h }
        function deletePod(i) { if (!confirm('UsunƒÖƒá?')) return; APP_DATA.podopieczni.splice(i, 1); renderPodopieczni(); alert('‚úì') }
        function renderWydarzenia() { let h = ''; APP_DATA.wydarzenia.forEach((e, i) => { h += `<div class="event-card"><h3>${e.title} <span class="badge badge-orange">${e.departments[0]}</span></h3><p>${e.description}</p><p style="font-size:12px;color:var(--text-secondary);margin-top:8px">${e.startDate} - ${e.endDate}</p><div style="margin-top:12px">${e.todos.map(t => `<div><input type="checkbox" ${t.completed ? 'checked' : ''}> ${t.task}</div>`).join('')}</div><button class="btn btn-sm btn-warning" onclick="openEditEvent(${i})">Edytuj</button> <button class="btn btn-sm btn-danger" onclick="deleteEvent(${i})">Usu≈Ñ</button></div>` }); document.getElementById('wydarzenia-container').innerHTML = h }
        function renderRecruitmentVol() { let h = ''; APP_DATA.rekrutacjaWolontariuszy.forEach((r, i) => { const m = r.meetings; const c = Object.values(m).filter(v => v !== '' && v !== 'nan').length; h += `<div class="recruit-card"><h3>${r.name} ${c === 4 ? '<span class="badge badge-green">‚úì</span>' : ''}</h3><p>üìß ${r.email}<br>üìû ${r.phone}<br>üìÖ ${r.dateJoined}</p><div style="margin-top:12px"><strong>Spotkania (${c}/4):</strong><br><label><input type="checkbox" ${m.charyzmat ? 'checked' : ''} onchange="toggleM(${i},'charyzmat')"> Charyzmat: ${m.charyzmat || '‚ùå'}</label><br><label><input type="checkbox" ${m.wspolnota ? 'checked' : ''} onchange="toggleM(${i},'wspolnota')"> Wsp√≥lnota: ${m.wspolnota || '‚ùå'}</label><br><label><input type="checkbox" ${m.dzialanie ? 'checked' : ''} onchange="toggleM(${i},'dzialanie')"> Dzia≈Çanie: ${m.dzialanie || '‚ùå'}</label><br><label><input type="checkbox" ${m.administracja ? 'checked' : ''} onchange="toggleM(${i},'administracja')"> Administracja: ${m.administracja || '‚ùå'}</label></div>${c === 4 ? `<button class="btn btn-success">Promuj</button>` : ''}</div>` }); document.getElementById('rec-vol-container').innerHTML = h }
        function toggleM(i, t) { const r = APP_DATA.rekrutacjaWolontariuszy[i]; const v = r.meetings[t]; r.meetings[t] = v === '' || v === 'nan' ? new Date().toLocaleDateString('pl-PL') : ''; renderRecruitmentVol() }
        function renderRecruitmentPod() { let h = ''; APP_DATA.rekrutacjaPodopiecznych.forEach((r, i) => { h += `<div class="recruit-card"><h3>${r.name} ${r.bo === 'TAK' ? '<span class="badge badge-green">BO</span>' : ''}</h3><p>üìç ${r.address}<br>üìû ${r.phone}<br>Status: ${r.status}</p><button class="btn btn-primary" onclick="openEditRec(${i})">Szczeg√≥≈Çy / Edytuj</button></div>` }); document.getElementById('rec-pod-container').innerHTML = h }
        function openEditRec(i) { currentRecIdx = i; const r = APP_DATA.rekrutacjaPodopiecznych[i]; document.getElementById('edit-rec-name').value = r.name; document.getElementById('edit-rec-address').value = r.address; document.getElementById('edit-rec-phone').value = r.phone; document.getElementById('edit-rec-status').value = r.status; document.getElementById('edit-rec-opis').value = r.opis; openModal() }
        function saveRecPod() { const r = APP_DATA.rekrutacjaPodopiecznych[currentRecIdx]; r.name = document.getElementById('edit-rec-name').value; r.address = document.getElementById('edit-rec-address').value; r.phone = document.getElementById('edit-rec-phone').value; r.status = document.getElementById('edit-rec-status').value; r.opis = document.getElementById('edit-rec-opis').value; renderRecruitmentPod(); closeModal(); alert('‚úì Zapisano!') }
        function deleteRecPod() { if (!confirm('UsunƒÖƒá?')) return; APP_DATA.rekrutacjaPodopiecznych.splice(currentRecIdx, 1); renderRecruitmentPod(); closeModal(); alert('‚úì') }
        function promoteRecPod() { const r = APP_DATA.rekrutacjaPodopiecznych[currentRecIdx]; const g = prompt('Grupa (A/B/C/D/E):', 'A'); if (!g) return; APP_DATA.podopieczni.push({ name: r.name, address: r.address, phone: r.phone, group: g, opis: r.opis, bo: r.bo, lastVisit: '', assignedVolunteers: [] }); APP_DATA.rekrutacjaPodopiecznych.splice(currentRecIdx, 1); renderRecruitmentPod(); renderPodopieczni(); closeModal(); alert('‚úì Promowano!') }
        function renderDepartments() { ALL_DEPARTMENTS.forEach((d, i) => { const dept = APP_DATA.departments[d]; document.getElementById(`dept-title-${i}`).textContent = d; document.getElementById(`dept-${i}-tab-0`).innerHTML = `<div class="card"><h3>Cz≈Çonkowie (${dept.memberCount})</h3><div style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px">${dept.members.map(m => `<span class="badge badge-blue">${m}</span>`).join('') || 'Brak'}</div></div>`; const dEv = APP_DATA.wydarzenia.filter(e => e.departments.includes(d)); document.getElementById(`dept-${i}-tab-1`).innerHTML = `<div class="card"><h3>Wydarzenia</h3>${dEv.length > 0 ? dEv.map(e => `<div style="background:var(--bg-hover);padding:12px;border-radius:8px;margin:8px 0"><strong>${e.title}</strong><p style="font-size:12px;margin-top:4px">${e.todos.length} zada≈Ñ (${e.todos.filter(t => t.completed).length} uko≈Ñczone)</p></div>`).join('') : '<p>Brak</p>'}</div>`; document.getElementById(`dept-${i}-tab-2`).innerHTML = `<div class="card"><h3>Sprzƒôt</h3>${dept.equipment.map(eq => `<div style="background:var(--bg-hover);padding:12px;border-radius:8px;margin:8px 0"><strong>${eq.name}</strong><p style="font-size:12px;margin-top:8px">Lokalizacja: ${eq.location}<br>U kogo: ${eq.currentHolder}<br>Od kiedy: ${eq.purchaseDate}<br>Notatki: ${eq.notes}</p><button class="btn btn-sm btn-warning">Edytuj</button></div>`).join('')}<button class="btn btn-primary">‚ûï Dodaj sprzƒôt</button></div>`; document.getElementById(`dept-${i}-tab-3`).innerHTML = `<div class="card"><h3>Powiadomienia</h3>${dept.notifications.map(n => `<div style="background:var(--bg-hover);padding:12px;border-radius:8px;margin:8px 0"><strong>${n.title}</strong><p>${n.message}</p><p style="font-size:11px;color:var(--text-secondary);margin-top:8px">${n.date} ‚Ä¢ ${n.author}</p></div>`).join('')}<button class="btn btn-primary">‚úâÔ∏è Napisz powiadomienie</button></div>` }) }
        // === WOLONTARIUSZE CRUD ===
        let currentVolIdx = null;
        function openAddVol() { currentVolIdx = null; document.getElementById('modal-vol-title').textContent = 'Dodaj Wolontariusza'; document.getElementById('vol-name').value = ''; document.getElementById('vol-email').value = ''; document.getElementById('vol-phone').value = ''; document.getElementById('vol-status').value = 'Aktywny'; document.getElementById('vol-group').value = 'A'; renderVolDepts([]); document.getElementById('modal-vol').classList.add('active'); }
        function openEditVol(i) { currentVolIdx = i; const v = APP_DATA.volunteers[i]; document.getElementById('modal-vol-title').textContent = 'Edytuj Wolontariusza'; document.getElementById('vol-name').value = v.name; document.getElementById('vol-email').value = v.email; document.getElementById('vol-phone').value = v.phone; document.getElementById('vol-status').value = v.status; document.getElementById('vol-group').value = v.group; renderVolDepts(v.departments); document.getElementById('modal-vol').classList.add('active'); }
        function renderVolDepts(selected) { let h = ''; ALL_DEPARTMENTS.forEach(d => { h += `<label style="display:block;margin:4px 0"><input type="checkbox" value="${d}" ${selected.includes(d) ? 'checked' : ''}> ${d}</label>`; }); document.getElementById('vol-departments').innerHTML = h; }
        function closeVolModal() { document.getElementById('modal-vol').classList.remove('active'); }
        function saveVol() { const deps = [...document.querySelectorAll('#vol-departments input:checked')].map(c => c.value); const vol = { name: document.getElementById('vol-name').value, email: document.getElementById('vol-email').value, phone: document.getElementById('vol-phone').value, status: document.getElementById('vol-status').value, group: document.getElementById('vol-group').value, departments: deps, assignedPodopieczny: '' }; if (currentVolIdx === null) { APP_DATA.volunteers.push(vol); } else { Object.assign(APP_DATA.volunteers[currentVolIdx], vol); } renderVolunteers(); closeVolModal(); alert('‚úì Zapisano!'); }
        // === PODOPIECZNI CRUD ===
        let currentPodIdx = null;
        function openAddPod() { currentPodIdx = null; document.getElementById('modal-pod-title').textContent = 'Dodaj Podopiecznego'; document.getElementById('pod-name').value = ''; document.getElementById('pod-address').value = ''; document.getElementById('pod-phone').value = ''; document.getElementById('pod-status').value = 'OBECNY'; document.getElementById('pod-group').value = 'A'; document.getElementById('pod-opis').value = ''; document.getElementById('pod-bo').value = 'NIE'; document.getElementById('modal-pod').classList.add('active'); }
        function openEditPod(i) { currentPodIdx = i; const p = APP_DATA.podopieczni[i]; document.getElementById('modal-pod-title').textContent = 'Edytuj Podopiecznego'; document.getElementById('pod-name').value = p.name; document.getElementById('pod-address').value = p.address; document.getElementById('pod-phone').value = p.phone; document.getElementById('pod-status').value = p.status; document.getElementById('pod-group').value = p.group; document.getElementById('pod-opis').value = p.opis || ''; document.getElementById('pod-bo').value = p.bo; document.getElementById('modal-pod').classList.add('active'); }
        function closePodModal() { document.getElementById('modal-pod').classList.remove('active'); }
        function savePod() { const pod = { name: document.getElementById('pod-name').value, address: document.getElementById('pod-address').value, phone: document.getElementById('pod-phone').value, status: document.getElementById('pod-status').value, group: document.getElementById('pod-group').value, opis: document.getElementById('pod-opis').value, bo: document.getElementById('pod-bo').value, lastVisit: '', assignedVolunteers: [] }; if (currentPodIdx === null) { APP_DATA.podopieczni.push(pod); } else { const old = APP_DATA.podopieczni[currentPodIdx]; pod.lastVisit = old.lastVisit; pod.assignedVolunteers = old.assignedVolunteers; Object.assign(APP_DATA.podopieczni[currentPodIdx], pod); } renderPodopieczni(); closePodModal(); alert('‚úì Zapisano!'); }
        // === WYDARZENIA CRUD ===
        let currentEventIdx = null;
        function openAddEvent() { currentEventIdx = null; document.getElementById('modal-event-title').textContent = 'Dodaj Wydarzenie'; document.getElementById('event-title').value = ''; document.getElementById('event-desc').value = ''; document.getElementById('event-start').value = ''; document.getElementById('event-end').value = ''; document.getElementById('event-status').value = 'planned'; renderEventDepts(''); document.getElementById('modal-event').classList.add('active'); }
        function openEditEvent(i) { currentEventIdx = i; const e = APP_DATA.wydarzenia[i]; document.getElementById('modal-event-title').textContent = 'Edytuj Wydarzenie'; document.getElementById('event-title').value = e.title; document.getElementById('event-desc').value = e.description; document.getElementById('event-start').value = e.startDate; document.getElementById('event-end').value = e.endDate; document.getElementById('event-status').value = e.status; renderEventDepts(e.departments[0]); document.getElementById('modal-event').classList.add('active'); }
        function renderEventDepts(selected) { let h = ''; ALL_DEPARTMENTS.forEach(d => { h += `<option value="${d}" ${selected === d ? 'selected' : ''}>${d}</option>`; }); document.getElementById('event-dept').innerHTML = h; }
        function closeEventModal() { document.getElementById('modal-event').classList.remove('active'); }
        function saveEvent() { const ev = { id: Date.now(), title: document.getElementById('event-title').value, description: document.getElementById('event-desc').value, startDate: document.getElementById('event-start').value, endDate: document.getElementById('event-end').value, status: document.getElementById('event-status').value, departments: [document.getElementById('event-dept').value], todos: [] }; if (currentEventIdx === null) { APP_DATA.wydarzenia.push(ev); } else { ev.id = APP_DATA.wydarzenia[currentEventIdx].id; ev.todos = APP_DATA.wydarzenia[currentEventIdx].todos; APP_DATA.wydarzenia[currentEventIdx] = ev; } renderWydarzenia(); closeEventModal(); alert('‚úì Zapisano!'); }
        function deleteEvent(i) { if (!confirm('UsunƒÖƒá wydarzenie?')) return; APP_DATA.wydarzenia.splice(i, 1); renderWydarzenia(); alert('‚úì Usuniƒôto!'); }
        // === GRUPY CRUD ===
        let currentGroupKey = null;
        function openAddGroup() { alert('Grupy A-E sƒÖ predefiniowane. U≈ºyj przycisku Edytuj, aby zmieniƒá przewodnika/zastƒôpcƒô.'); }
        function openEditGroup(g) { currentGroupKey = g; const gr = APP_DATA.groups[g]; document.getElementById('modal-group-title').textContent = 'Edytuj Grupƒô ' + g; let opts = '<option value="">-- Wybierz --</option>'; APP_DATA.volunteers.filter(v => v.status === 'Aktywny').forEach(v => { opts += `<option value="${v.name}">${v.name}</option>`; }); document.getElementById('group-leader').innerHTML = opts; document.getElementById('group-deputy').innerHTML = opts; document.getElementById('group-leader').value = gr.leader || ''; document.getElementById('group-deputy').value = gr.deputy || ''; document.getElementById('modal-group').classList.add('active'); }
        function closeGroupModal() { document.getElementById('modal-group').classList.remove('active'); }
        function saveGroup() { APP_DATA.groups[currentGroupKey].leader = document.getElementById('group-leader').value; APP_DATA.groups[currentGroupKey].deputy = document.getElementById('group-deputy').value; renderGroups(); closeGroupModal(); alert('‚úì Zapisano!'); }
        console.log('‚úì A PAULO v4.5 FINAL za≈Çadowany - CRUD aktywny');
    </script>
</body>

</html>